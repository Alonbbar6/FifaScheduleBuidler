import Foundation

struct Match: Identifiable, Codable, Hashable {
    let id: Int
    let homeTeam: Team
    let awayTeam: Team
    let league: League
    let date: Date
    let status: MatchStatus
    let homeScore: Int?
    let awayScore: Int?
    let venue: String?
    let referee: String?
    let events: [MatchEvent]?
    let isLiked: Bool
    let isFavorited: Bool
    let userRating: Double?
    let watchLink: String?
    
    enum MatchStatus: String, Codable, CaseIterable {
        case scheduled = "SCHEDULED"
        case live = "LIVE"
        case finished = "FINISHED"
        case halftime = "HALFTIME"
        case postponed = "POSTPONED"
        case cancelled = "CANCELLED"
        
        var displayName: String {
            switch self {
            case .scheduled: return "Scheduled"
            case .live: return "LIVE"
            case .finished: return "FT"
            case .halftime: return "HT"
            case .postponed: return "Postponed"
            case .cancelled: return "Cancelled"
            }
        }
        
        var color: String {
            switch self {
            case .scheduled: return "blue"
            case .live: return "red"
            case .finished: return "green"
            case .halftime: return "orange"
            case .postponed: return "gray"
            case .cancelled: return "red"
            }
        }
        
        var isActive: Bool {
            return self == .live || self == .halftime
        }
    }
    
    init(id: Int, homeTeam: Team, awayTeam: Team, league: League, date: Date, status: MatchStatus, homeScore: Int? = nil, awayScore: Int? = nil, venue: String? = nil, referee: String? = nil, events: [MatchEvent]? = nil, isLiked: Bool = false, isFavorited: Bool = false, userRating: Double? = nil, watchLink: String? = nil) {
        self.id = id
        self.homeTeam = homeTeam
        self.awayTeam = awayTeam
        self.league = league
        self.date = date
        self.status = status
        self.homeScore = homeScore
        self.awayScore = awayScore
        self.venue = venue
        self.referee = referee
        self.events = events
        self.isLiked = isLiked
        self.isFavorited = isFavorited
        self.userRating = userRating
        self.watchLink = watchLink
    }
    
    var formattedDate: String {
        let formatter = DateFormatter()
        formatter.dateStyle = .medium
        formatter.timeStyle = .short
        return formatter.string(from: date)
    }
    
    var formattedTime: String {
        let formatter = DateFormatter()
        formatter.timeStyle = .short
        return formatter.string(from: date)
    }
    
    var score: String {
        guard let homeScore = homeScore, let awayScore = awayScore else {
            return "vs"
        }
        return "\(homeScore) - \(awayScore)"
    }
    
    var isToday: Bool {
        Calendar.current.isDateInToday(date)
    }
    
    var isUpcoming: Bool {
        date > Date() && status == .scheduled
    }
    
    var isPast: Bool {
        date < Date() || status == .finished
    }
}

struct MatchEvent: Identifiable, Codable, Hashable {
    let id: Int
    let type: EventType
    let player: String
    let team: String
    let minute: Int
    let description: String?
    
    enum EventType: String, Codable, CaseIterable {
        case goal = "GOAL"
        case yellowCard = "YELLOW_CARD"
        case redCard = "RED_CARD"
        case substitution = "SUBSTITUTION"
        case penalty = "PENALTY"
        case ownGoal = "OWN_GOAL"
        case var = "VAR"
        
        var icon: String {
            switch self {
            case .goal: return "soccerball"
            case .yellowCard: return "rectangle.fill"
            case .redCard: return "rectangle.fill"
            case .substitution: return "arrow.left.arrow.right"
            case .penalty: return "target"
            case .ownGoal: return "soccerball"
            case .var: return "video"
            }
        }
        
        var color: String {
            switch self {
            case .goal: return "green"
            case .yellowCard: return "yellow"
            case .redCard: return "red"
            case .substitution: return "blue"
            case .penalty: return "purple"
            case .ownGoal: return "orange"
            case .var: return "blue"
            }
        }
    }
}

// MARK: - Mock Data
extension Match {
    static let mockMatches: [Match] = [
        Match(id: 1, homeTeam: Team.mockTeams[0], awayTeam: Team.mockTeams[1], league: League.mockLeagues[0], date: Date().addingTimeInterval(3600), status: .live, homeScore: 2, awayScore: 1, venue: "Old Trafford", referee: "John Smith", events: [], isLiked: true, isFavorited: false, userRating: 4.5, watchLink: "https://fifa.com/watch"),
        Match(id: 2, homeTeam: Team.mockTeams[2], awayTeam: Team.mockTeams[3], league: League.mockLeagues[0], date: Date().addingTimeInterval(7200), status: .scheduled, venue: "Emirates Stadium", referee: "Mike Johnson", events: [], isLiked: false, isFavorited: true, userRating: nil, watchLink: "https://fifa.com/watch"),
        Match(id: 3, homeTeam: Team.mockTeams[4], awayTeam: Team.mockTeams[0], league: League.mockLeagues[0], date: Date().addingTimeInterval(-86400), status: .finished, homeScore: 3, awayScore: 0, venue: "Etihad Stadium", referee: "David Wilson", events: [], isLiked: true, isFavorited: true, userRating: 5.0, watchLink: nil),
        Match(id: 4, homeTeam: Team.mockTeams[5], awayTeam: Team.mockTeams[6], league: League.mockLeagues[1], date: Date().addingTimeInterval(86400), status: .scheduled, venue: "Santiago BernabÃ©u", referee: "Carlos Rodriguez", events: [], isLiked: false, isFavorited: false, userRating: nil, watchLink: "https://fifa.com/watch")
    ]
}